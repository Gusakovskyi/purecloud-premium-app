<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Premium App Wizard</title>

    <link href='//fonts.googleapis.com/css?family=Lato:300,400' rel='stylesheet' async type='text/css'>
    <link rel="stylesheet" href="./styles/style.css">

    <script src="https://sdk-cdn.mypurecloud.com/javascript/latest/purecloud-platform-client-v2.min.js"></script>
    <script src="https://sdk-cdn.mypurecloud.com/client-apps/2.3.0/purecloud-client-app-sdk.js"></script>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>
</head>

<body>
    <div id="background"></div>
    <noscript>
        For full functionality of this site it is necessary to enable JavaScript. Here are the <a
            href="http://www.enable-javascript.com/" target="_blank">instructions how to enable JavaScript in your web
            browser</a>.
    </noscript>

    <header>
        <p id="content-header-text"><span class="txt-premium-app-name">Premium App</span> /&nbsp; <span class="txt-premium-install">Install</span></p>
    </header>

    <div class="content">
        <div class="title">
            Installation
        </div>

        <ul class="progress-bar">
            <li class="active">
                <span class="txt-start">Start</span>
            </li>
            <li id="progress-custom-setup" class="active">
                <span class="txt-setup">Custom Setup</span>
            </li>
            <li class="active current">
                <span class="txt-install">Install</span>
            </li>
            <li class="">
                <span class="txt-summary">Summary</span>
            </li>
        </ul>

        <main>
            <p>
                <span class="txt-install-summary">These are the steps that will be automatically performed for
                    you!</span>
            </p>

            <div id="messages" class="messages">
                <div class="message">
                    <div class="message-title">
                        <span>1. </span><span class="txt-create-role">Create Role</span>
                    </div>
                    <div class="message-content">
                        <div>
                            <span class="txt-create-role-msg">
                                Create a role specifically to provide access to the app.
                            </span>
                        </div>
                    </div>
                </div>

                <div class="message">
                    <div class="message-title">
                        <span>2. </span><span class="txt-create-group">Create Groups</span>
                    </div>
                    <div class="message-content">
                        <div>
                            <span class="txt-create-group-msg">
                                Groups will provide filtering to users' access to the app instances.
                            </span>
                        </div>
                    </div>
                </div>

                <div class="message">
                    <div class="message-title">
                        <span>3. </span><span class="txt-create-app-instance">Create instances</span>
                    </div>
                    <div class="message-content">
                        <div>
                            <span class="txt-create-app-instance-msg">
                                More instances of the app will be created with different URI endpoints to provide
                                different features of the app.
                            </span>
                        </div>
                    </div>
                </div>

                <div class="message">
                    <div class="message-title">
                        <span>4. </span><span class="txt-create-oauth-client">Create OAuth Client</span>
                    </div>
                    <div class="message-content">
                        <div>
                            <span class="txt-create-oauth-client-msg">
                                An optional OAuth Client could be created for server-to-server communication. After
                                creation, it should be followed by a method that will pass the OAuth Client information
                                to the app's server.
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <p class="sink-more">
                <span class="txt-please-click">
                    Please click the button to start the installation.
                </span>
            </p>

            <button id="start" class="btn-info right">
                <span class="txt-start">Start</span> <i class="button-icon fas fa-chevron-right"></i>
            </button>
        </main>
    </div>
    <footer>
        <img src="./assets/img/logo.png" alt="Logo">
    </footer>

    <!-- MODAL-->
    <div id="loading-modal">
        <div class="overlay"></div>
        <div class="modal">
            <img class="logo" src='./assets/img/loading.svg' alt="" srcset="">
            <div class="modal-message"></div>
        </div>
    </div>

    <script type="module">
        import config from './config/config.js';

        if (config.enableDynamicInstallSummary == true) {
            let messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';

            let modulesToInstall = Object.keys(config.provisioningInfo);
            if (config.enableCustomSetupStepAfterInstall === true) {
                modulesToInstall.push('post-custom-setup');
            }
            let moduleIndex = 0;
            modulesToInstall.forEach(modKey => {
                moduleIndex++;
                let messageDiv = document.createElement("div");
                messageDiv.className = "message";

                let messageTitle = document.createElement("div");
                messageTitle.className = "message-title";
                messageTitle.innerHTML = "<span>" + moduleIndex.toString() + ". </span><span class='txt-create-" + modKey + "'></span>";
                messageDiv.appendChild(messageTitle);

                let messageContent = document.createElement("div");
                messageContent.className = "message-content";
                messageContent.innerHTML = "<div><span class='txt-create-" + modKey + "-msg'></span></div>";
                messageDiv.appendChild(messageContent);

                messagesDiv.appendChild(messageDiv);

                //  document.body.insertBefore(newDiv, currentDiv);


            });

            // Language
            // TODO - may not be necessary as it is invoked from main.js (after) as well
            let pcLanguage = localStorage.getItem(config.premiumAppIntegrationTypeId + ':language') || config.defaultLanguage;

            config.setPageLanguage(pcLanguage)
                .then(() => {
                    console.log('Localization applied: ', pcLanguage);
                })
                .catch((e) => {
                    console.error(e);
                });

        }

    </script>

    <script src="./scripts/main.js" type="module"></script>
</body>

</html>